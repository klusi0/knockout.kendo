//knockout.kendo v0.1.0 | (c) 2012 Tomasz MikuÅ› | http://www.opensource.org/licenses/mit-license
(function(a,b,c){function d(b,c){for(var d in c){var e=c[d];a.isObservable(e)?(e()?b.addClass(d):b.removeClass(d),e.subscribe(function(a){a?b.addClass(d):b.removeClass(d)})):e?b.addClass(d):b.removeClass(d)}}function e(a,b){if(b)for(var c in b)a.bind(c,b[c])}function f(b,c){var d=c.enable;(a.isObservable(d)||a.isComputed(d))&&(d.subscribe(function(a){b.enable(a)}),d=c.enable()),b.enable(d)}function g(b,c){if(null!=c.isBusy){if(!a.isObservable(c.isBusy))throw"ComboBox'es IsBusy must be observable!";c.isBusy.subscribe(function(a){a?(b.enable(!1),b._busy=null,b._showBusy()):(b._hideBusy(),b.enable(!0))})}}a.bindingHandlers.kendoAutoComplete={init:function(g,h){var k=b.extend({css:{},dataSource:[],dataTextField:null,dataValueField:null,delay:200,enable:!0,event:{},filter:"startswith",height:200,highlightFirst:!0,ignoreCase:!0,minLength:1,placeholder:"",separator:"",suggest:!1,value:null},h()),l=k.dataTextField?function(a){return a[k.dataTextField]}:function(a){return a},m=k.dataValueField?function(a){return a[k.dataValueField]}:function(a){return a},n=null,o=null,p=function(a){if(!a||""==a)return n.value(null),c;for(var b=o.total(),d=0;b>d;d++)if(m(o.at(d))==a){n.value(l(o.at(d)));break}},q=null,r=k.value,s=b(g);null!=r&&a.isObservable(r)&&(r.kendoAutoCompleteSubscription&&r.kendoAutoCompleteSubscription.dispose(),q=r.kendoAutoCompleteSubscription=r.subscribe(function(a){p(a)}),r=r());var t=null;a.isObservable(k.dataSource)?(o=new kendo.data.DataSource({data:k.dataSource()}),k.dataSource.kendoAutoCompleteSubscription&&k.dataSource.kendoAutoCompleteSubscription.dispose(),t=k.dataSource.kendoAutoCompleteSubscription=k.dataSource.subscribe(function(a){o.cancelChanges();for(var b=0;a.length>b;b++)o.add(a[b]);p(r),n.popup.open()})):b.isArray(k.dataSource)?o=new kendo.data.DataSource({data:k.dataSource}):(o=k.dataSource,o.bind("requestEnd",function(){setTimeout(function(){n.popup.open()},0)}));var u=function(a){(a.popup.wrapper[0]?a.popup.wrapper:a.popup.element).remove(),a.element.show().insertBefore(a.wrapper),a.wrapper.remove(),a.element.removeData("kendoComboBox"),t&&t.dispose(),q&&q.dispose()};n=s.kendoAutoComplete({dataSource:o,dataTextField:k.dataTextField,delay:k.delay,filter:k.filter,height:k.height,highlightFirst:k.highlightFirst,ignoreCase:k.ignoreCase,minLength:k.minLength,placeholder:k.placeholder,separator:k.separator,suggest:k.suggest}).data("kendoAutoComplete"),f(n,k),s.on("removing",function(){u(n)}),p(r),null!=k.value&&a.isObservable(k.value)&&(n.bind("select",function(a){a||k.value(null);for(var b=a.item[0],c=n.ul[0].children,d=c.length,e=0;d>e;e++)if(b==c[e]){k.value(n._data()[e]);break}}),k.value.subscribe(function(a){n.value(a)})),e(n,k.event),d(b(n.element).parent(),k.css)}},a.bindingHandlers.kendoComboBox={init:function(f,h){var k=h(),l=k.dataTextField?function(a){return a[k.dataTextField]}:function(a){return a},m=k.dataValueField?function(a){return a[k.dataValueField]}:function(a){return a},n=null,o=null,p=k.value,q=function(a){a=a?a:p;for(var b=o.total(),d=0;b>d;d++)if(m(o.at(d))==a)return n.value(o.at(d)),n.text(l(o.at(d))),c;n.value(null)};null!=p&&a.isObservable(p)&&(p.subscribe(function(a){p=a,q()}),p=p());var r=function(c){var d=[];if(k.dataTextField||k.dataValueField)for(var e=0;c.length>e;e++){var f=b.extend({},c[e]);k.dataTextField&&a.isObservable(f[k.dataTextField])&&(f[k.dataTextField]=f[k.dataTextField]()),k.dataValueField&&a.isObservable(f[k.dataValueField])&&(f[k.dataValueField]=f[k.dataValueField]()),d.push(f)}else d=c;return d};a.isObservable(k.dataSource)?(o=new kendo.data.DataSource({data:r(k.dataSource())}),k.dataSource.subscribe(function(a){o.cancelChanges();for(var b=r(a),c=0;b.length>c;c++)o.add(b[c]);q()})):o=b.isArray(k.dataSource)?new kendo.data.DataSource({data:r(k.dataSource)}):k.dataSource,k.dataSource=o,k.enable!=c&&null!=k.enable&&(k.enable=a.utils.unwrapObservable(k.enable)),n=b(f).kendoComboBox(b.extend({},k,{value:null})).data("kendoComboBox"),g(n,k),q(),null!=k.value&&a.isObservable(k.value)&&(n.bind("select",function(a){a||k.value(null),k.value(-1==a.item.index()?null:m(this.dataItem(a.item.index())))}),n.bind("change",function(a){a||k.value(null),k.value(-1==this.selectedIndex?null:m(this.dataItem(this.selectedIndex)))})),e(n,k.event),d(b(n.element).parent(),k.css)},update:function(d,e){var i=e(),j=b(d).data("kendoComboBox");i.enable!=c&&null!=i.enable&&j.enable(a.utils.unwrapObservable(i.enable))}},a.bindingHandlers.kendoDropDownList={init:function(h,i){var l=i(),m=l.dataValueField?function(a){return a[l.dataValueField]}:function(a){return a},n=null,o=null,p=l.value,q=null;q=l.dataSource?function(a){a=a?a:p;for(var b=o.total(),d=0;b>d;d++)if(m(o.at(d))==a)return n.value(a),c;n.value(null)}:function(a){n.value(a?a:p)},null!=p&&a.isObservable(p)&&(p.subscribe(function(a){p=a,q()}),p=p()),a.isObservable(l.dataSource)?(o=new kendo.data.DataSource({data:l.dataSource()}),l.dataSource.subscribe(function(a){o.cancelChanges();for(var b=0;a.length>b;b++)o.add(a[b]);q()})):b.isArray(l.dataSource)?o=new kendo.data.DataSource({data:l.dataSource}):l.dataSource&&(o=l.dataSource),o?l.dataSource=o:l.dataSource&&delete l.dataSource,n=b(h).kendoDropDownList(l).data("kendoDropDownList"),q(),f(n,l),g(n,l),null!=l.value&&a.isObservable(l.value)&&(l.dataSource?(n.bind("select",function(a){a||l.value(null),l.value(m(this.dataItem(a.item.index())))}),n.bind("change",function(a){a||l.value(null),l.value(m(this.dataItem(this.selectedIndex)))})):(n.bind("select",function(a){a||l.value(null),l.value(this.value())}),n.bind("change",function(a){a||l.value(null),l.value(this.value())}))),e(n,l.event),d(b(n.element).parent(),l.css)}},a.bindingHandlers.kendoDatePicker={init:function(c,g){var j=b.extend({animation:!1,css:{},depth:"month",enable:!0,event:{},format:"MM/dd/yyyy",max:new Date(2099,11,31),min:new Date(1900,0,1),start:"month",value:null},g()),k=null,l=j.value;null!=l&&a.isObservable(l)&&(l.subscribe(function(a){k.value(a)}),l=l()),k=b(c).kendoDatePicker({animation:j.animation,depth:j.depth,format:j.format,max:j.max,min:j.min,start:j.start,value:l}).data("kendoDatePicker"),f(k,j),null!=j.value&&a.isObservable(j.value)&&k.bind("change",function(a){a||j.value(null);var b=this.value(),c=j.value();null==b?j.value(null):j.value(new Date(b.getFullYear(),b.getMonth(),b.getDate(),c?c.getHours():0,c?c.getMinutes():0,c?c.getSeconds():0))}),e(k,j.event),d(b(k.element).parent().parent(),j.css)}},a.bindingHandlers.kendoTimePicker={init:function(c,g){var j=b.extend({css:{},enable:!0,event:{},format:"h:mm tt",interval:30,max:new Date(0,0),min:new Date(0,0),value:null},g()),k=null,l=j.value;null!=l&&a.isObservable(l)&&(l.subscribe(function(a){k.value(a)}),l=l()),k=b(c).kendoTimePicker({format:j.format,interval:j.interval,max:j.max,min:j.min,value:l}).data("kendoTimePicker"),f(k,j),null!=j.value&&a.isObservable(j.value)&&k.bind("change",function(a){a||j.value(null),j.value(this.value())}),e(k,j.event),d(b(k.element).parent().parent(),j.css)}},a.bindingHandlers.kendoNumericTextBox={init:function(c,g){var j=g(),k=null,l=j.value;null!=l&&a.isObservable(l)&&(l.subscribe(function(a){k.value(a)}),j.value=l()),k=b(c).kendoNumericTextBox(j).data("kendoNumericTextBox"),f(k,j),null!=l&&a.isObservable(l)&&k.bind("change",function(a){a||l(null),l(this.value())}),e(k,j.event),d(b(k.element).parent().parent(),j.css)}}})(ko,jQuery);