//knockout.kendo v0.1.0 | (c) 2012 Tomasz Miku≈õ | http://www.opensource.org/licenses/mit-license
(function(ko,$,undefined){ko.bindingHandlers.kendoAutoComplete={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var configuration=$.extend({css:{},dataSource:[],dataTextField:null,dataValueField:null,enable:!0,event:{change:null,close:null,open:null,select:null},filter:"startswith",height:200,highlightFirst:!0,ignoreCase:!0,minLength:1,placeholder:"",separator:"",suggest:!1,value:null},valueAccessor()),accessDataItemText=configuration.dataTextField==null?function(dataItem){return dataItem}:function(dataItem){return dataItem[configuration.dataTextField]},accessDataItemValue=configuration.dataValueField==null?function(dataItem){return dataItem}:function(dataItem){return dataItem[configuration.dataValueField]},control=null,controlDataSource=null,setValue=function(value){var count=controlDataSource.total();for(var index=0;index<count;index++)if(accessDataItemValue(controlDataSource.at(index))==value){control.value(accessDataItemText(controlDataSource.at(index)));break}},valueToSet=configuration.value,$element=$(element);valueToSet!=null&&ko.isObservable(valueToSet)&&(valueToSet.subscribe(function(value){setValue(value)}),valueToSet=valueToSet()),ko.isObservable(configuration.dataSource)?(controlDataSource=new kendo.data.DataSource({data:configuration.dataSource()}),configuration.dataSource.subscribe(function(value){controlDataSource.cancelChanges();for(var index=0;index<value.length;index++)controlDataSource.add(value[index]);setValue(valueToSet),control.popup.open()})):$.isArray(configuration.dataSource)?controlDataSource=new kendo.data.DataSource({data:configuration.dataSource}):controlDataSource=configuration.dataSource,control=$element.kendoAutoComplete({dataSource:controlDataSource,dataTextField:configuration.dataTextField,enable:configuration.enable,filter:configuration.filter,height:configuration.height,highlightFirst:configuration.highlightFirst,ignoreCase:configuration.ignoreCase,minLength:configuration.minLength,placeholder:configuration.placeholder,separator:configuration.separator,suggest:configuration.suggest}).data("kendoAutoComplete"),$element.on("removing",function(){(control.popup.wrapper[0]?control.popup.wrapper:control.popup.element).remove(),control.element.show().insertBefore(control.wrapper),control.wrapper.remove(),control.element.removeData("kendoComboBox")}),setValue(valueToSet),configuration.value!=null&&ko.isObservable(configuration.value)&&control.bind("select",function(e){e||configuration.value(null);var currentItem=e.item[0],itemsCollection=control.ul[0].children,itemsCount=itemsCollection.length;for(var index=0;index<itemsCount;index++)if(currentItem==itemsCollection[index]){configuration.value(control._data()[index]);break}}),configuration.event.change!=null&&control.bind("change",configuration.event.change),configuration.event.close!=null&&control.bind("close",configuration.event.close),configuration.event.open!=null&&control.bind("open",configuration.event.open),configuration.event.select!=null&&control.bind("select",configuration.event.select);var controlElement=$(control.element).parent();for(var className in configuration.css){var classValue=configuration.css[className];ko.isObservable(classValue)?(classValue()?controlElement.addClass(className):controlElement.removeClass(className),classValue.subscribe(function(value){value?controlElement.addClass(className):controlElement.removeClass(className)})):classValue?controlElement.addClass(className):controlElement.removeClass(className)}}},ko.bindingHandlers.kendoComboBox={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var configuration=$.extend({animation:!1,css:{},dataSource:[],dataTextField:null,dataValueField:null,enable:!0,event:{change:null,close:null,open:null,select:null},filter:"startswith",height:500,highLightFirst:!0,ignoreCase:!0,minLength:1,placeholder:"",separator:"",suggest:!1,value:null},valueAccessor()),accessDataItemText=configuration.dataTextField==null?function(dataItem){return dataItem}:function(dataItem){return dataItem[configuration.dataTextField]},accessDataItemValue=configuration.dataValueField==null?function(dataItem){return dataItem}:function(dataItem){return dataItem[configuration.dataValueField]},control=null,controlDataSource=null,setValue=function(value){var count=controlDataSource.total();for(var index=0;index<count;index++)if(accessDataItemValue(controlDataSource.at(index))==value){control.value(ko.utils.unwrapObservable(accessDataItemText(controlDataSource.at(index))));break}},valueToSet=configuration.value;valueToSet!=null&&ko.isObservable(valueToSet)&&(valueToSet.subscribe(function(value){setValue(value)}),valueToSet=valueToSet());var enable=configuration.enable;ko.isObservable(enable)&&(enable.subscribe(function(newValue){control.enable(newValue)}),enable=configuration.enable()),ko.isObservable(configuration.dataSource)?(controlDataSource=new kendo.data.DataSource({data:configuration.dataSource().map(function(val){if(ko.isObservable(accessDataItemText(val))){var text=accessDataItemText(val)();if(configuration.dataTextField==null)return text;var obj={};return obj[configuration.dataTextField]=text,$.extend({},val,obj)}})}),configuration.dataSource.subscribe(function(value){controlDataSource.cancelChanges();for(var index=0;index<value.length;index++)controlDataSource.add(value[index]);setValue(valueToSet)})):$.isArray(configuration.dataSource)?controlDataSource=new kendo.data.DataSource({data:configuration.dataSource}):controlDataSource=configuration.dataSource,control=$(element).kendoComboBox({animation:configuration.animation,dataSource:controlDataSource,dataTextField:configuration.dataTextField,enable:enable,filter:configuration.filter,height:configuration.height,highlightFirst:configuration.highlightFirst,ignoreCase:configuration.ignoreCase,minLength:configuration.minLength,placeholder:configuration.placeholder,separator:configuration.separator,suggest:configuration.suggest}).data("kendoComboBox"),setValue(valueToSet),configuration.value!=null&&ko.isObservable(configuration.value)&&control.bind("select",function(e){e||configuration.value(null);var currentItem=e.item[0],itemsCollection=control.ul[0].children,itemsCount=itemsCollection.length;for(var index=0;index<itemsCount;index++)if(currentItem==itemsCollection[index]){configuration.value(accessDataItemValue(control._data()[index]));break}}),configuration.event.change!=null&&control.bind("change",configuration.event.change),configuration.event.close!=null&&control.bind("close",configuration.event.close),configuration.event.open!=null&&control.bind("open",configuration.event.open),configuration.event.select!=null&&control.bind("select",configuration.event.select);var controlElement=$(control.element).parent();for(var className in configuration.css){var classValue=configuration.css[className];ko.isObservable(classValue)?(classValue()?controlElement.addClass(className):controlElement.removeClass(className),classValue.subscribe(function(value){value?controlElement.addClass(className):controlElement.removeClass(className)})):classValue?controlElement.addClass(className):controlElement.removeClass(className)}}},ko.bindingHandlers.kendoDropDownList={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var configuration=$.extend({animation:!1,css:{},dataSource:[],dataTextField:null,dataValueField:null,delay:500,enable:!0,event:{change:null,close:null,open:null,select:null},height:500,ignoreCase:!0,index:0,optionLabel:"",value:null},valueAccessor()),accessDataItemText=configuration.dataTextField==null?function(dataItem){return dataItem}:function(dataItem){return dataItem[configuration.dataTextField]},accessDataItemValue=configuration.dataValueField==null?function(dataItem){return dataItem}:function(dataItem){return dataItem[configuration.dataValueField]},control=null,controlDataSource=null,valueToSet=configuration.value,rebindValue=function(value){control.value(value?value:valueToSet)};valueToSet!=null&&ko.isObservable(valueToSet)&&(valueToSet.subscribe(function(value){control.value(valueToSet=value)}),valueToSet=valueToSet());var enable=configuration.enable;ko.isObservable(enable)&&(enable.subscribe(function(newValue){control.enable(newValue)}),enable=enable()),ko.isObservable(configuration.dataSource)?(controlDataSource=new kendo.data.DataSource({data:configuration.dataSource()}),configuration.dataSource.subscribe(function(value){controlDataSource.cancelChanges();for(var index=0;index<value.length;index++)controlDataSource.add(value[index]);rebindValue()})):$.isArray(configuration.dataSource)?controlDataSource=new kendo.data.DataSource({data:configuration.dataSource}):controlDataSource=configuration.dataSource,control=$(element).kendoDropDownList({animation:configuration.animation,dataSource:controlDataSource,dataTextField:configuration.dataTextField,dataValueField:configuration.dataValueField,delay:configuration.delay,enable:enable,height:configuration.height,ignoreCase:configuration.ignoreCase,index:configuration.index,optionLabel:configuration.optionLabel}).data("kendoDropDownList"),rebindValue(),configuration.value!=null&&ko.isObservable(configuration.value)&&control.bind("select",function(e){e||configuration.value(null);var currentItem=e.item[0],itemsCollection=control.ul[0].children,itemsCount=itemsCollection.length;for(var index=0;index<itemsCount;index++)if(currentItem==itemsCollection[index]){configuration.value(this.value());break}}),configuration.event.change!=null&&control.bind("change",configuration.event.change),configuration.event.close!=null&&control.bind("close",configuration.event.close),configuration.event.open!=null&&control.bind("open",configuration.event.open),configuration.event.select!=null&&control.bind("select",configuration.event.select);var controlElement=$(control.element).parent();for(var className in configuration.css){var classValue=configuration.css[className];ko.isObservable(classValue)?(classValue()?controlElement.addClass(className):controlElement.removeClass(className),classValue.subscribe(function(value){value?controlElement.addClass(className):controlElement.removeClass(className)})):classValue?controlElement.addClass(className):controlElement.removeClass(className)}}},ko.bindingHandlers.kendoDatePicker={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var configuration=$.extend({animation:!1,css:{},depth:"month",enable:!0,event:{change:null,close:null,open:null},format:"MM/dd/yyyy",max:new Date(2099,11,31),min:new Date(1900,0,1),start:"month",value:null},valueAccessor()),control=null,valueToSet=configuration.value;valueToSet!=null&&ko.isObservable(valueToSet)&&(valueToSet.subscribe(function(value){control.value(value)}),valueToSet=valueToSet());var enable=configuration.enable;ko.isObservable(enable)&&(enable.subscribe(function(newValue){control.enable(newValue)}),enable=configuration.enable()),control=$(element).kendoDatePicker({animation:configuration.animation,depth:configuration.depth,format:configuration.format,max:configuration.max,min:configuration.min,start:configuration.start,value:valueToSet}).data("kendoDatePicker"),configuration.value!=null&&ko.isObservable(configuration.value)&&control.bind("change",function(e){e||configuration.value(null),configuration.value(this.value())}),configuration.event.change!=null&&control.bind("change",configuration.event.change),configuration.event.close!=null&&control.bind("close",configuration.event.close),configuration.event.open!=null&&control.bind("open",configuration.event.open);var controlElement=$(control.element).parent();for(var className in configuration.css){var classValue=configuration.css[className];ko.isObservable(classValue)?(classValue()?controlElement.addClass(className):controlElement.removeClass(className),classValue.subscribe(function(value){value?controlElement.addClass(className):controlElement.removeClass(className)})):classValue?controlElement.addClass(className):controlElement.removeClass(className)}}}})(ko,jQuery)