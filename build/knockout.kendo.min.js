//knockout.kendo v0.1.0 | (c) 2012 Tomasz Miku≈õ | http://www.opensource.org/licenses/mit-license
(function(e,t,n){function r(t,n){for(var r in n){var i=n[r];e.isObservable(i)?(i()?t.addClass(r):t.removeClass(r),i.subscribe(function(e){e?t.addClass(r):t.removeClass(r)})):i?t.addClass(r):t.removeClass(r)}}function i(e,t){for(var n in t)e.bind(n,t[n])}function s(t,n){var r=n.enable;e.isObservable(r)&&(r.subscribe(function(e){t.enable(e)}),r=n.enable()),t.enable(r)}function o(t,n){if(n.isBusy==null)return;if(!e.isObservable(n.isBusy))throw"ComboBox'es IsBusy must be observable!";n.isBusy.subscribe(function(e){e?(t.enable(!1),t._busy=null,t._showBusy()):(t._hideBusy(),t.enable(!0))})}e.bindingHandlers.kendoAutoComplete={init:function(n,o,u,a){var f=t.extend({css:{},dataSource:[],dataTextField:null,dataValueField:null,enable:!0,event:{},filter:"startswith",height:200,highlightFirst:!0,ignoreCase:!0,minLength:1,placeholder:"",separator:"",suggest:!1,value:null},o()),l=f.dataTextField?function(e){return e[f.dataTextField]}:function(e){return e},c=f.dataValueField?function(e){return e[f.dataValueField]}:function(e){return e},h=null,p=null,d=function(e){var t=p.total();for(var n=0;n<t;n++)if(c(p.at(n))==e){h.value(l(p.at(n)));break}},v=null,m=f.value,g=t(n);m!=null&&e.isObservable(m)&&(m.kendoAutoCompleteSubscription&&m.kendoAutoCompleteSubscription.dispose(),v=m.kendoAutoCompleteSubscription=m.subscribe(function(e){d(e)}),m=m());var y=null;e.isObservable(f.dataSource)?(p=new kendo.data.DataSource({data:f.dataSource()}),f.dataSource.kendoAutoCompleteSubscription&&f.dataSource.kendoAutoCompleteSubscription.dispose(),y=f.dataSource.kendoAutoCompleteSubscription=f.dataSource.subscribe(function(e){p.cancelChanges();for(var t=0;t<e.length;t++)p.add(e[t]);d(m),h.popup.open()})):t.isArray(f.dataSource)?p=new kendo.data.DataSource({data:f.dataSource}):p=f.dataSource;var b=function(e){(e.popup.wrapper[0]?e.popup.wrapper:e.popup.element).remove(),e.element.show().insertBefore(e.wrapper),e.wrapper.remove(),e.element.removeData("kendoComboBox"),y&&y.dispose(),v&&v.dispose()};h=g.kendoAutoComplete({dataSource:p,dataTextField:f.dataTextField,filter:f.filter,height:f.height,highlightFirst:f.highlightFirst,ignoreCase:f.ignoreCase,minLength:f.minLength,placeholder:f.placeholder,separator:f.separator,suggest:f.suggest}).data("kendoAutoComplete"),s(h,f),g.on("removing",function(){b(h)}),d(m),f.value!=null&&e.isObservable(f.value)&&h.bind("select",function(e){e||f.value(null);var t=e.item[0],n=h.ul[0].children,r=n.length;for(var i=0;i<r;i++)if(t==n[i]){f.value(h._data()[i]);break}}),i(h,f.event),r(t(h.element).parent(),f.css)}},e.bindingHandlers.kendoComboBox={init:function(n,u,a,f){var l=t.extend({animation:!1,css:{},dataSource:[],dataTextField:"",dataValueField:"",enable:!0,event:{},filter:"startswith",height:200,highLightFirst:!0,ignoreCase:!0,isBusy:null,minLength:1,placeholder:"",separator:"",suggest:!1,value:null},u()),c=l.dataTextField==null?function(e){return e}:function(e){return e[l.dataTextField]},h=l.dataValueField==null?function(e){return e}:function(e){return e[l.dataValueField]},p=null,d=null,v=l.value,m=function(e){e=e?e:v;var t=d.total();for(var n=0;n<t;n++)if(h(d.at(n))==e){p.value(d.at(n)),p.text(c(d.at(n)));return}p.value(null)};v!=null&&e.isObservable(v)&&(v.subscribe(function(e){v=e,m()}),v=v());var g=function(n){var r=[];if(l.dataTextField||l.dataValueField)for(var i=0;i<n.length;i++){var s=t.extend({},n[i]);l.dataTextField&&e.isObservable(s[l.dataTextField])&&(s[l.dataTextField]=s[l.dataTextField]()),l.dataValueField&&e.isObservable(s[l.dataValueField])&&(s[l.dataValueField]=s[l.dataValueField]()),r.push(s)}else r=n;return r};e.isObservable(l.dataSource)?(d=new kendo.data.DataSource({data:g(l.dataSource())}),l.dataSource.subscribe(function(e){d.cancelChanges();var t=g(e);for(var n=0;n<t.length;n++)d.add(t[n]);m()})):t.isArray(l.dataSource)?d=new kendo.data.DataSource({data:g(l.dataSource)}):d=l.dataSource,p=t(n).kendoComboBox({animation:l.animation,dataSource:d,dataTextField:l.dataTextField,filter:l.filter,height:l.height,highlightFirst:l.highlightFirst,ignoreCase:l.ignoreCase,minLength:l.minLength,placeholder:l.placeholder,separator:l.separator,suggest:l.suggest}).data("kendoComboBox"),s(p,l),o(p,l),m(),l.value!=null&&e.isObservable(l.value)&&(p.bind("select",function(e){e||l.value(null),l.value(e.item.index()==-1?null:h(this.dataItem(e.item.index())))}),p.bind("change",function(e){e||l.value(null),l.value(this.selectedIndex==-1?null:h(this.dataItem(this.selectedIndex)))})),i(p,l.event),r(t(p.element).parent(),l.css)}},e.bindingHandlers.kendoDropDownList={init:function(n,u,a,f){var l=t.extend({animation:!1,css:{},dataSource:null,dataTextField:null,dataValueField:null,delay:500,enable:!0,event:{},height:200,ignoreCase:!0,isBusy:null,index:0,optionLabel:"",value:null},u()),c=l.dataTextField==null?function(e){return e}:function(e){return e[l.dataTextField]},h=l.dataValueField==null?function(e){return e}:function(e){return e[l.dataValueField]},p=null,d=null,v=l.value,m=null;l.dataSource?m=function(e){e=e?e:v;var t=d.total();for(var n=0;n<t;n++)if(h(d.at(n))==e){p.value(e);return}p.value(null)}:m=function(e){p.value(e?e:v)},v!=null&&e.isObservable(v)&&(v.subscribe(function(e){v=e,m()}),v=v()),e.isObservable(l.dataSource)?(d=new kendo.data.DataSource({data:l.dataSource()}),l.dataSource.subscribe(function(e){d.cancelChanges();for(var t=0;t<e.length;t++)d.add(e[t]);m()})):t.isArray(l.dataSource)?d=new kendo.data.DataSource({data:l.dataSource}):l.dataSource&&(d=l.dataSource),d?(p=t(n).kendoDropDownList({animation:l.animation,dataSource:d,dataTextField:l.dataTextField,dataValueField:l.dataValueField,delay:l.delay,height:l.height,ignoreCase:l.ignoreCase,index:l.index,optionLabel:l.optionLabel}).data("kendoDropDownList"),m()):p=t(n).kendoDropDownList({animation:l.animation,delay:l.delay,height:l.height,ignoreCase:l.ignoreCase,index:l.index,optionLabel:l.optionLabel}).data("kendoDropDownList"),s(p,l),o(p,l),l.value!=null&&e.isObservable(l.value)&&(l.dataSource?(p.bind("select",function(e){e||l.value(null),l.value(h(this.dataItem(e.item.index())))}),p.bind("change",function(e){e||l.value(null),l.value(h(this.dataItem(this.selectedIndex)))})):(p.bind("select",function(e){e||l.value(null),l.value(this.value())}),p.bind("change",function(e){e||l.value(null),l.value(this.value())}))),i(p,l.event),r(t(p.element).parent(),l.css)}},e.bindingHandlers.kendoDatePicker={init:function(n,o,u,a){var f=t.extend({animation:!1,css:{},depth:"month",enable:!0,event:{},format:"MM/dd/yyyy",max:new Date(2099,11,31),min:new Date(1900,0,1),start:"month",value:null},o()),l=null,c=f.value;c!=null&&e.isObservable(c)&&(c.subscribe(function(e){l.value(e)}),c=c()),l=t(n).kendoDatePicker({animation:f.animation,depth:f.depth,format:f.format,max:f.max,min:f.min,start:f.start,value:c}).data("kendoDatePicker");if(kendo.support.touch){var h="td:has(.k-link)",p=l.dateView.calendar;p.element.undelegate(h,"touchstart touchend").delegate(h,"touchstart touchend",function(e){t(this).toggleClass("k-state-hover",e.type=="touchstart")}).delegate(h,"touchend",t.proxy(p._click,p)),h=".k-header > .k-link",p.element.undelegate(h,"touchstart touchend").delegate(h,"touchstart touchend",function(e){t(this).toggleClass("k-state-hover",e.type=="touchstart")}).delegate(h,"touchend",function(e){t(this).click()})}s(l,f),f.value!=null&&e.isObservable(f.value)&&l.bind("change",function(e){e||f.value(null);var t=this.value(),n=f.value();f.value(new Date(t.getFullYear(),t.getMonth(),t.getDate(),n?n.getHours():0,n?n.getMinutes():0,n?n.getSeconds():0))}),i(l,f.event),r(t(l.element).parent().parent(),f.css)}},e.bindingHandlers.kendoTimePicker={init:function(n,o,u,a){var f=t.extend({css:{},enable:!0,event:{},format:"h:mm tt",interval:30,max:new Date(0,0),min:new Date(0,0),value:null},o()),l=null,c=f.value;c!=null&&e.isObservable(c)&&(c.subscribe(function(e){l.value(e)}),c=c()),l=t(n).kendoTimePicker({format:f.format,interval:f.interval,max:f.max,min:f.min,value:c}).data("kendoTimePicker"),s(l,f),f.value!=null&&e.isObservable(f.value)&&l.bind("change",function(e){e||f.value(null),f.value(this.value())}),i(l,f.event),r(t(l.element).parent().parent(),f.css)}},e.bindingHandlers.kendoNumericTextBox={init:function(n,o,u,a){var f=o(),l=null,c=f.value;c!=null&&e.isObservable(c)&&(c.subscribe(function(e){l.value(e)}),f.value=c()),l=t(n).kendoNumericTextBox(f).data("kendoNumericTextBox"),s(l,f),c!=null&&e.isObservable(c)&&l.bind("change",function(e){e||c(null),c(this.value())}),i(l,f.event),r(t(l.element).parent().parent(),f.css)}}})(ko,jQuery)